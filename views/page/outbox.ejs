  <!-- outbox.ejs -->
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <!-- Meta tags and title -->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #f4f4f4;
          margin: 0;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          height: 100vh;
        }
    
        section {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    
        h2 {
          color: #333;
        }
    
        ul {
          list-style-type: none;
          padding: 0;
        }
    
        li {
          border-bottom: 1px solid #ccc;
          padding: 10px 0;
          display: flex;
          justify-content: space-between;
        }
    
        .pagination {
          margin-top: 20px;
          display: flex;
          justify-content: center;
          align-items: center;
        }
    
        .pagination a {
          padding: 8px;
          margin: 0 5px;
          text-decoration: none;
          color: #333;
          border: 1px solid #ccc;
          border-radius: 4px;
        }
    
        .pagination .active {
          background-color: #4caf50;
          color: #fff;
        }
      </style>
      <title>Email System - Outbox</title>
    
    </head>

<% 
  function getRecipientFullName(recipientId, users) {
    const recipient = users.find(user => user.id === recipientId);
    return recipient ? recipient.full_name : 'Unknown Sender';
  }
%>
    <body>
      <!-- Header section -->
      <header>
        <h1>Welcome, <%= user.full_name %>!</h1>
        <nav>
          <!-- Navigation links -->
          <ul>
            <li><a href="/inbox">Inbox</a></li>
            <li><a href="/compose">Compose</a></li>
            <li><a href="/outbox">Outbox</a></li>
            <li><a href="/signout">Sign Out</a></li>
          </ul>
        </nav>
      </header>
    
      <!-- Main section -->
      <section>
        <h2>Outbox</h2>
    
        <% if (outboxEmails.length > 0) { %>
          <!-- Display emails and pagination -->
          <ul>
            <% outboxEmails.forEach(email => { %>
              <!-- Email item with checkbox and details -->
              <li>
                <input type="checkbox" name="selectedEmails" value="<%= email.id %>">
                <span><%= getRecipientFullName(email.recipient_id, users) %></span>
                <span><a href="/emaildetail/<%= email.id %>">
                  <p><%= email.subject %></p>
                </a></span>
                <span><%= email.time_sent %></span>
                <!-- Add any additional details you want to display -->
              </li>
            <% }); %>
          </ul> 
    
          <!-- Pagination links -->
          <% for (let i = 1; i <= totalPages; i++) { %>
            <a href="/outbox?page=<%= i %>"><%= i %></a>
          <% } %>
    
          <!-- Delete button (Advanced Requirement) -->
          <button id="deleteBtn">Delete Selected Emails</button>
    
          <script>
            // JavaScript for handling delete button click
            document.getElementById('deleteBtn').addEventListener('click', async () => {
              // Get selected email IDs
              const selectedEmails = Array.from(document.querySelectorAll('input[name="selectedEmails"]:checked'))
                .map(checkbox => checkbox.value);
    
              if (selectedEmails.length > 0) {
                // Make a fetch request to delete emails using an API endpoint
                const response = await fetch('/api/deleteemails', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ emailIds: selectedEmails }),
                });
    
                if (response.ok) {
                  // Remove deleted emails from the current page without reloading
                  selectedEmails.forEach(emailId => {
                    const emailElement = document.querySelector(`input[value="${emailId}"]`);
                    emailElement.parentElement.remove();
                  });
                } else {
                  console.error('Failed to delete emails');
                }
              }
            });
          </script>
        <% } else { %>
          <!-- Message for empty outbox -->
          <p>No emails in the outbox.</p>
        <% } %>
      </section>
    </body>
  </html>
